# Реализация пагинации и глобального поиска

## Дата: 2026-01-16

## Обзор изменений

Реализована полноценная пагинация и глобальный поиск по Email/имени для всех разделов (Bfisherman, RBesolov, Archive).

## 1. Изменения в API (wpService.ts)

### Обновленная функция `fetchReviews`

**Новые параметры:**
- `page: number = 1` - номер страницы (по умолчанию 1)
- `search: string = ''` - поисковый запрос

**Новый возвращаемый тип:**
```typescript
interface PaginationMeta {
  total: number;          // Общее количество отзывов
  totalPages: number;     // Всего страниц
  currentPage: number;    // Текущая страница
}

interface FetchReviewsResult {
  reviews: UnifiedReview[];
  pagination: PaginationMeta;
}
```

**Ключевые особенности:**
- Параметр `per_page=20` для отображения 20 отзывов на странице
- Извлечение заголовков WordPress API:
  - `X-WP-Total` - общее количество записей
  - `X-WP-TotalPages` - общее количество страниц
- Поддержка поиска через параметр `search` WordPress API

## 2. Компонент SearchBar

**Расположение:** `/components/SearchBar.tsx`

**Функциональность:**
- Debounce 500мс для оптимизации запросов к серверу
- Поиск по полям: email и author (имя)
- Кнопка очистки с анимацией
- Дизайн в стиле macOS с glassmorphism эффектом

**Стилизация:**
- `backdrop-blur-md` - размытие фона
- `bg-white/80` - полупрозрачный белый фон
- Плавные переходы и hover эффекты
- Иконка поиска и кнопка очистки

## 3. Компонент Pagination

**Расположение:** `/components/Pagination.tsx`

**Функциональность:**
- Кнопки "Previous" / "Next"
- Индикатор "Page X of Y"
- Автоматическое скрытие при totalPages <= 1
- Блокировка кнопок при загрузке или на граничных страницах

**Стилизация:**
- Современный дизайн с glassmorphism
- Адаптивность (скрытие текста на мобильных)
- Плавные анимации появления

## 4. Обновления DashboardLayout

### Новое состояние:
```typescript
const [searchQuery, setSearchQuery] = useState('');
const [currentPage, setCurrentPage] = useState(1);
```

### Логика для WordPress проектов (Bfisherman, RBesolov):
- Серверная пагинация через WordPress API
- Серверный поиск через параметр `search`
- Автоматический сброс страницы при смене фильтра/поиска

### Логика для Archive (Telegram):
- **Клиентская пагинация** (20 записей на страницу)
- **Клиентский поиск** по email и author
- Реализовано через `useMemo` для оптимизации

```typescript
const paginatedArchiveReviews = useMemo(() => {
  // Фильтрация по поисковому запросу
  // Разбиение на страницы по 20 записей
  // Возврат { reviews, pagination }
}, [archiveReviews, filter, searchQuery, currentPage]);
```

### Интеграция в UI:
- SearchBar добавлен над списком отзывов
- Pagination добавлен под списком отзывов
- Skeleton loader отображается во время загрузки

## 5. Сброс состояния

При смене проекта автоматически сбрасываются:
- `searchQuery` → пустая строка
- `currentPage` → 1
- `filter` → 'all'

При смене фильтра или поискового запроса:
- `currentPage` → 1 (через useEffect)

## 6. Дизайн

### SearchBar:
- Полупрозрачный фон с размытием (`backdrop-blur-md`)
- Иконка поиска слева
- Кнопка очистки справа (появляется при вводе)
- Плавные переходы и фокус-эффекты

### Pagination:
- Белый фон с тенью
- Центральный индикатор страницы с акцентным цветом
- Адаптивные кнопки Previous/Next
- Disabled состояние для граничных случаев

## 7. Производительность

- **Debounce** в SearchBar предотвращает избыточные запросы
- **useMemo** для клиентской пагинации архива
- **useCallback** для всех обработчиков событий
- **AnimatePresence** для плавных переходов

## 8. Совместимость

- ✅ Bfisherman.no - серверная пагинация и поиск
- ✅ RBesolov.com - серверная пагинация и поиск
- ✅ Archive (TG) - клиентская пагинация и поиск

## 9. Тестирование

Для проверки функциональности:

1. **Поиск:**
   - Введите email или имя в поле поиска
   - Результаты обновятся через 500мс после окончания ввода
   - Кнопка очистки появится при наличии текста

2. **Пагинация:**
   - Переключайтесь между страницами кнопками Previous/Next
   - Индикатор показывает текущую страницу
   - Кнопки блокируются на граничных страницах

3. **Комбинация:**
   - Поиск автоматически сбрасывает на первую страницу
   - Смена фильтра сбрасывает поиск и страницу
   - Смена проекта сбрасывает все состояния

## 10. Файлы изменений

- ✅ `/services/wpService.ts` - добавлены параметры пагинации и поиска
- ✅ `/components/SearchBar.tsx` - новый компонент
- ✅ `/components/Pagination.tsx` - новый компонент
- ✅ `/components/DashboardLayout.tsx` - интеграция поиска и пагинации
